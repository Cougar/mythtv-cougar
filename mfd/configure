#!/bin/sh
#
# Pathetic configure script for mfd
#
# NB: It doesn't do any dependencies checking
#
#

# default parameters

zeroconfig="yes"
audio="yes"
daapserver="yes"
daapclient="yes"
httpserver="yes"
mmusic="yes"
wmasupport="yes"
aacsupport="no"
discwatchersupport="yes"
mfdclient="yes"
rtsp="yes"

for opt do
  case "$opt" in
  --enable-zeroconfig) zeroconfig="yes"
  ;;
  --disable-zeroconfig) zeroconfig="no"
  ;;
  --enable-audio) audio="yes"
  ;;
  --disable-audio) audio="no"
  ;;
  --enable-daapserver) daapserver="yes"
  ;;
  --disable-daapserver) daapserver="no"
  ;;
  --enable-daapclient) daapclient="yes"
  ;;
  --disable-daapclient) daapclient="no"
  ;;
  --enable-httpserver) httpserver="yes"
  ;;
  --disable-httpserver) httpserver="no"
  ;;
  --enable-mythmusic) mmusic="yes"
  ;;
  --disable-mythmusic) mmusic="no"
  ;;
  --enable-wmasupport) wmasupport="yes"
  ;;
  --disable-wmasupport) wmasupport="no"
  ;;
  --enable-aacsupport) aacsupport="yes"
  ;;
  --disable-aacsupport) aacsupport="no"
  ;;
  --enable-discwatcher) discwatchersupport="yes"
  ;;
  --disable-discwatcher) discwatchersupport="no"
  ;;
  --enable-mfdclient) mfdclient="yes"
  ;;
  --disable-mfdclient) mfdclient="no"
  ;;
  --enable-rtsp) rtsp="yes"
  ;;
  --disable-rtsp) rtsp="no"
  ;;
  --enable-all)
      zeroconfig="yes"
      audio="yes"
      daapserver="yes"
      daapclient="yes"
      httpserver="yes"
      mmusic="yes"
      wmasupport="yes"
      aacsupport="yes"
      discwatchersupport="yes"
      mfdclient="yes"
      rtsp="yes"
  ;;
  --disable-all)
      zeroconfig="no"
      audio="no"
      daapserver="no"
      daapclient="no"
      httpserver="no"
      mmusic="no"
      wmasupport="no"
      aacsupport="no"
      discwatchersupport="no"
      mfdclient="no"
      rtsp="no"
  ;;
  esac
done

#
#   Sanity checking
#

if test "$audio" = "no" ; then
    wmasupport="no"
    aacsupport="no"
fi

if test x"$1" = x"-h" -o x"$1" = x"--help" ; then
cat << EOF

Usage: configure [options]
Options: [defaults in brackets after descriptions]

Standard options:
  --help               print this message
  --enable-zeroconfig  enable auto discovery of services       [default=yes]
  --enable-audio       enable audio playing                    [default=yes]
  --enable-wmasupport  include ability to play wma audio files [default=yes]
  --enable-aacsupport  include ability to play aac audio files [default=no ]
  --enable-daapserver  enable serving audio via daap           [default=yes]
  --enable-daapclient  enable consuming audio via daap         [default=yes]
  --enable-httpserver  enable basic client interface via http  [default=yes]
  --enable-mythmusic   enable serving mythmusic audio content  [default=yes]
  --enable-discwatcher monitor optical drives for content      [default=yes]
  --enable-mfdclient   build libmfdclient                      [default=yes]
  --enable-rtsp        rtsp support (HIGHLY recommended)       [default=no]

All options can be turned off with --disable-foo
Some options will be automatically turned off if they make no sense 

EOF
exit 1
fi

echo ""
echo "Creating config.pro"
echo "#" > ./config.pro
echo "#    Automatically generated by configure - modify only under penalty of death" >> ./config.pro
echo "#" >> ./config.pro
echo " " >> ./config.pro
echo "#    The dummy plugin is always built " >> ./config.pro
echo " " >> ./config.pro
echo "SUBDIRS += ./mfd/plugins/dummy " >> ./config.pro
echo " " >> ./config.pro


echo "Creating config.h"
echo "/*" > ./config.h
echo "     Automatically generated by configure - modify only under penalty of death" >> ./config.h
echo "*/" >> ./config.h
echo " " >> ./config.h
echo " " >> ./config.h


echo "Creating options.pro"
echo "#" > ./options.pro
echo "#    Automatically generated by configure - modify only under penalty of death" >> ./options.pro
echo "#" >> ./options.pro
echo " " >> ./options.pro
echo " " >> ./options.pro


echo ""
echo "Configuration settings: "
echo " "



#
#   Myth lib
#

#
#   Dummy
#

    echo "                      dummy support: yes (always)"


#
#   Zero config
#

if test "$zeroconfig" = "yes" ; then
    echo "                 zeroconfig support: yes"        
    echo "#    Build the zeroconfig plugin " >> ./config.pro
    echo " " >> ./config.pro
    echo "SUBDIRS += ./mfd/plugins/zeroconfig " >> ./config.pro
    echo " " >> ./config.pro
fi

if test "$zeroconfig" = "no" ; then
    echo "                 zeroconfig support: no"
fi

#
#   audio
#

if test "$audio" = "yes" ; then
    echo "                      audio support: yes"

    #
    #   Conditional build and link stuff for audio
    #

    echo "SUBDIRS += ./mfd/plugins/audio "   >> ./config.pro

fi

if test "$audio" = "no" ; then
    echo "                      audio support: no"
fi

#
#   WMA support
#

if test "$wmasupport" = "yes" ; then
    echo "                        wma support: yes"        
    echo "//  Include wma support " >> ./config.h
    echo " " >> ./config.h
    echo "#define WMA_AUDIO_SUPPORT 1" >> ./config.h
    echo " " >> ./config.h
    echo "USE_WMA_AUDIO = 1 " >> ./options.pro
fi

if test "$wmasupport" = "no" ; then
    echo "                        wma support: no"
fi

#
#   AAC support
#

if test "$aacsupport" = "yes" ; then
    echo "                        aac support: yes"        
    echo "//  Include aac support " >> ./config.h
    echo " " >> ./config.h
    echo "#define AAC_AUDIO_SUPPORT 1" >> ./config.h
    echo " " >> ./config.h
    echo "USE_AAC_AUDIO = 1 " >> ./options.pro
fi

if test "$aacsupport" = "no" ; then
    echo "                        aac support: no"
fi

#
#   daapserver
#

if test "$daapserver" = "yes" ; then
    echo "                daap server support: yes"

    #
    #   Conditional build and link stuff for daap server
    #

    echo "SUBDIRS += ./mfd/plugins/daapserver/daaplib "   >> ./config.pro
    echo "SUBDIRS += ./mfd/plugins/daapserver "   >> ./config.pro

fi

if test "$daapserver" = "no" ; then
    echo "                daap server support: no"
fi


#
#   daapclient
#

if test "$daapclient" = "yes" ; then
    echo "                daap client support: yes"

    #
    #   Conditional build and link stuff for daap server
    #

    echo "SUBDIRS += ./mfd/plugins/daapclient "   >> ./config.pro

fi

if test "$daapclient" = "no" ; then
    echo "                daap client support: no"
fi

#
#   httpserver
#

if test "$httpserver" = "yes" ; then
    echo "                http server support: yes"

    #
    #   Conditional build and link stuff for http server
    #

    echo "SUBDIRS += ./mfd/plugins/httpserver "   >> ./config.pro

fi

if test "$httpserver" = "no" ; then
    echo "                http server support: no"
fi


#
#   Myth Music
#

if test "$mmusic" = "yes" ; then
    echo "                  mythmusic support: yes"        
    echo "#    Build the myth music plugin " >> ./config.pro
    echo " " >> ./config.pro
    echo "SUBDIRS += ./mfd/plugins/mmusic " >> ./config.pro
    echo " " >> ./config.pro
fi

if test "$mmusic" = "no" ; then
    echo "                  mythmusic support: no"
fi


#
#   Disc Watcher
#

if test "$discwatchersupport" = "yes" ; then
    echo "               disc watcher support: yes"        
    echo "#    Build disc watching plugin " >> ./config.pro
    echo " " >> ./config.pro
    echo "SUBDIRS += ./mfd/plugins/discwatcher " >> ./config.pro
    echo " " >> ./config.pro
fi

if test "$discwatchersupport" = "no" ; then
    echo "               disc watcher support: no"
fi

#
#   libmfdclient
#

if test "$mfdclient" = "yes" ; then
    echo "                 build libmfdclient: yes"        
    echo "#    Build libmfdclient " >> ./config.pro
    echo " " >> ./config.pro
    echo "SUBDIRS += ./clientlib " >> ./config.pro
    echo " " >> ./config.pro
fi

if test "$mfdclient" = "no" ; then
    echo "                 build libmfdclient: no"
fi


#
#   rtsp
#

if test "$rtsp" = "yes" ; then
    echo "                       rtsp support: yes"        
#    echo "#    Build rtsp " >> ./config.pro
#    echo " " >> ./config.pro
#    echo "SUBDIRS += ./plugins/rtspserver " >> ./config.pro
#    echo " " >> ./config.pro
    echo "//  Include rtsp support " >> ./config.h
    echo " " >> ./config.h
    echo "#define MFD_RTSP_SUPPORT 1" >> ./config.h
    echo " " >> ./config.h
    echo "MFD_RTSP_SUPPORT = 1 " >> ./options.pro
fi

if test "$rtsp" = "no" ; then
    echo "                       rtsp support: no"
fi




echo ""

