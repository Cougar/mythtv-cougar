#!/bin/sh
#
# Pathetic configure script for mfd
#
# NB: It doesn't do any dependencies checking
#
#

# default parameters

mythlib="yes"
zeroconfig="yes"
audio="yes"
daapserver="yes"
daapclient="yes"
mmusic="yes"
wmasupport="yes"
aacsupport="no"

for opt do
  case "$opt" in
  --enable-mythlib) mythlib="yes"
  ;;
  --disable-mythlib) mythlib="no"
  ;;
  --enable-zeroconfig) zeroconfig="yes"
  ;;
  --disable-zeroconfig) zeroconfig="no"
  ;;
  --enable-audio) audio="yes"
  ;;
  --disable-audio) audio="no"
  ;;
  --enable-daapserver) daapserver="yes"
  ;;
  --disable-daapserver) daapserver="no"
  ;;
  --enable-daapclient) daapclient="yes"
  ;;
  --disable-daapclient) daapclient="no"
  ;;
  --enable-mythmusic) mmusic="yes"
  ;;
  --disable-mythmusic) mmusic="no"
  ;;
  --enable-wmasupport) wmasupport="yes"
  ;;
  --disable-wmasupport) wmasupport="no"
  ;;
  --enable-aacsupport) aacsupport="yes"
  ;;
  --disable-aacsupport) aacsupport="no"
  ;;
  --enable-all)
      zeroconfig="yes"
      audio="yes"
      daapserver="yes"
      daapclient="yes"
      mythlib="yes"
      mmusic="yes"
      wmasupport="yes"
      aacsupport="yes"
  ;;
  --disable-all)
      zeroconfig="no"
      audio="no"
      daapserver="no"
      daapclient="no"
      mythlib="no"
      mmusic="no"
      wmasupport="no"
      aacsupport="no"
  ;;
  esac
done

#
#   Sanity checking
#

if test "$mythlib" = "no" ; then
    mmusic="no"
    wmasupport="no"
fi

if test x"$1" = x"-h" -o x"$1" = x"--help" ; then
cat << EOF

Usage: configure [options]
Options: [defaults in brackets after descriptions]

Standard options:
  --help               print this message
  --enable-mythlib     use mythlib/db for settings and content [default=yes] 
  --enable-zeroconfig  enable auto discovery of services       [default=yes]
  --enable-audio       enable audio playing                    [default=yes]
  --enable-wmasupport  include ability to play wma audio files [default=yes]
  --enable-aacsupport  include ability to play aac audio files [default=no ]
  --enable-daapserver  enable serving audio via daap           [default=yes]
  --enable-daapclient  enable consuming audio via daap         [default=yes]
  --enable-mythmusic   enable serving mythmusic audio content  [default=yes]

All options can be turned off with --disable-foo
Some options will be automatically turned off if they make no sense 
(e.g. you can't include mythmusic if you turn off mythlib support)

EOF
exit 1
fi

echo ""
echo "Creating config.pro"
echo "#" > ./config.pro
echo "#    Automatically generated by configure - modify only under penalty of death" >> ./config.pro
echo "#" >> ./config.pro
echo " " >> ./config.pro
echo "#    The dummy plugin is always built " >> ./config.pro
echo " " >> ./config.pro
echo "SUBDIRS += ./mfd/plugins/dummy " >> ./config.pro
echo " " >> ./config.pro


echo "Creating config.h"
echo "/*" > ./config.h
echo "     Automatically generated by configure - modify only under penalty of death" >> ./config.h
echo "*/" >> ./config.h
echo " " >> ./config.h
echo " " >> ./config.h


echo "Creating options.pro"
echo "#" > ./options.pro
echo "#    Automatically generated by configure - modify only under penalty of death" >> ./options.pro
echo "#" >> ./options.pro
echo " " >> ./options.pro
echo " " >> ./options.pro


echo ""
echo "Configuration settings: "
echo " "



#
#   Myth lib
#

if test "$mythlib" = "yes" ; then
    echo "                    mythlib support: yes"        
    echo "//  Include mythlib support " >> ./config.h
    echo " " >> ./config.h
    echo "#define MYTHLIB_SUPPORT 1" >> ./config.h
    echo " " >> ./config.h
    echo "USE_MYTH_LIB = 1 " >> ./options.pro
fi

if test "$mythlib" = "no" ; then
    echo "                    mythlib support: no"
fi

#
#   Dummy
#

    echo "                      dummy support: yes (always)"


#
#   Zero config
#

if test "$zeroconfig" = "yes" ; then
    echo "                 zeroconfig support: yes"        
    echo "#    Build the zeroconfig plugin " >> ./config.pro
    echo " " >> ./config.pro
    echo "SUBDIRS += ./mfd/plugins/zeroconfig " >> ./config.pro
    echo " " >> ./config.pro
fi

if test "$zeroconfig" = "no" ; then
    echo "                 zeroconfig support: no"
fi

#
#   audio
#

if test "$audio" = "yes" ; then
    echo "                      audio support: yes"

    #
    #   Conditional build and link stuff for audio
    #

    echo "SUBDIRS += ./mfd/plugins/audio "   >> ./config.pro

fi

if test "$audio" = "no" ; then
    echo "                      audio support: no"
fi

#
#   WMA support
#

if test "$wmasupport" = "yes" ; then
    echo "                        wma support: yes"        
    echo "//  Include wma support " >> ./config.h
    echo " " >> ./config.h
    echo "#define WMA_AUDIO_SUPPORT 1" >> ./config.h
    echo " " >> ./config.h
    echo "USE_WMA_AUDIO = 1 " >> ./options.pro
fi

if test "$wmasupport" = "no" ; then
    echo "                        wma support: no"
fi

#
#   AAC support
#

if test "$aacsupport" = "yes" ; then
    echo "                        aac support: yes"        
    echo "//  Include aac support " >> ./config.h
    echo " " >> ./config.h
    echo "#define AAC_AUDIO_SUPPORT 1" >> ./config.h
    echo " " >> ./config.h
    echo "USE_AAC_AUDIO = 1 " >> ./options.pro
fi

if test "$aacsupport" = "no" ; then
    echo "                        aac support: no"
fi

#
#   daapserver
#

if test "$daapserver" = "yes" ; then
    echo "                daap server support: yes"

    #
    #   Conditional build and link stuff for daap server
    #

    echo "SUBDIRS += ./mfd/plugins/daapserver/daaplib "   >> ./config.pro
    echo "SUBDIRS += ./mfd/plugins/daapserver "   >> ./config.pro

fi

if test "$daapserver" = "no" ; then
    echo "                daap server support: no"
fi


#
#   daapclient
#

if test "$daapclient" = "yes" ; then
    echo "                daap client support: yes"

    #
    #   Conditional build and link stuff for daap server
    #

    echo "SUBDIRS += ./mfd/plugins/daapclient "   >> ./config.pro

fi

if test "$daapclient" = "no" ; then
    echo "                daap client support: no"
fi

#
#   Myth Music
#

if test "$mmusic" = "yes" ; then
    echo "                  mythmusic support: yes"        
    echo "#    Build the myth music plugin " >> ./config.pro
    echo " " >> ./config.pro
    echo "SUBDIRS += ./mfd/plugins/mmusic " >> ./config.pro
    echo " " >> ./config.pro
fi

if test "$mmusic" = "no" ; then
    echo "                  mythmusic support: no"
fi




echo ""

