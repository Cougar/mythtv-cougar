                             MythPhone
                             =========
Release 0.15
Paul Volkaerts



COMPILING MYTHPHONE
===================
If you are not using the Festival TTS Engine, then just type
    ./configure
    qmake mythphone.pro
    make
    make install (as root)

If you want to use the TTS engine then first of all download Festival
as per below then edit the file "configure" and set the paths for where 
you have installed Festival in variables FESTIVALDIR and SPEECHTOOLSDIR. 
Then;

    ./configure --enable-festival
    qmake mythphone.pro
    make
    make install (as root)



PREREQUISITES
=============
There are no mandatory prerequisites other than Myth itself; but you can
compile in support for a Text to Speech (TTS) engine called Festival. This
enables support for voicemail and reading of the TV Guide over the phone.

Festival Text-to-Speech Engine v1.4.3 
http://www.cstr.ed.ac.uk/projects/festival/

Download and follow the instructions in the INSTALL file. You will
need to download the main file festival-1.4.3-release.tar.gz and the
toolset speech_tools-1.2.3-release.tar.gz. Then you also need some data
files, as a minimum festlex_CMU.tar.gz, festlex_POSLEX.tar.gz and
festvox_kallpc8k.tar.gz. This gives a male English voice. You can follow
the instructions to download others to try other voices. The myth setup 
screens allow you to pick from your downloaded voices.
To compile, simply run ./configure then make within first the 
speech_tools directory and then the festival directory. 




FEATURES / HOW-TO-USE
=====================
Mythphone uses a SIP stack to allow voice and/or video calls to
be placed to other SIP clients. This includes other MythFrontends on your
system, Mythfrontends over the Internet, or other standard SIP clients. I
have verified SIP support against a couple of standards-based devices for
voice calls but video has some caveats (see below).

Features:-

* Contact database for click-dialling
* Voice calls at G.711 20ms
* Video calls at H.263
* Pan and Zoom for video calls, useful if your web-cam captures at a higher 
resolution than you transmit
* Voicemail
* Send/receive DTMF (RFC 2833)
* VXML scripting with Text-To-Speech engine allows you to call in and hear 
the TV Guide / set recording etc
* Full screen video
* Call history
* Popup whilst watching TV shows a call is coming in; though currently you 
have to navigate to mythphone to answer it.
* NAT and Firewall handling (see below)

Keys:-
* Up/Down/Left/Right/Select/Exit for most features
* Menu (M) key is context sensitive
* Play (P) during a call toggles video into full screen mode
* Home/End during a call zooms local webcam
* U/D/L/R during a call pans the local webcam
* 0..9, * and # during a call send DTMF
* 0..9, * and # NOT during open a dial dialogue
* Volume Up/Down changes the speaker volume; but whilst in volume-change mode
you can use Up/Down to switch to Brightness/Colour/Contrast etc.
* Mute (|) mutes the microphone during a call

The usual way of dialling is to add a contact into the database then
dial by selecting this entry.  The contact URL should be of the format 
user@ip-address or user@hostname.  Mythphone actually ignores "user" for 
incoming calls so set this to anything you want when calling between
mythfrontends.

Status-Bar:-
The status bar shows 
* call state (idle/connected/ringing etc)
* Audio & Video packet loss as xx%/yy% where xx% is percentage packet loss over
the last 2 seconds and yy% packet loss is total for the call. This tells you
how good your receive signal is
* Bandwidth. This is a total figure for voice+video. If it read above 256k and
you only have a 256k upstream link then the person you are speaking to is going
to get a pretty poor signal. Use this to match the transmit rate to your 
available upstream bandwidth. You can reduce by lowering the video resolution 
or frame rate.



WEB-CAM SUPPORT
===============
I use a Logitech webcam with the Philips PWC driver built into the kernel 
(Linux 2.4.23).  For this to work at reasonable rates you need to download
the decompression module pwcx.o and install using "insmod --force pwcx.o".
You get this from www.smcc.demon.nl/webcam.

This webcam stores its settings locally; so you can download "camstream" from
the above URL to tune its settings.

You also need to set the Frames Per Second when the module is loaded too, as 
there is no support in this application for writing to these Phillips-specific
parameters. (The FPS attribute in the setup screens tells the software what to
expect from the webcam; it does not configure the webcam).

I also use the microphone built into this webcam by enabling the kernel 
option for USB audio. 



NAT and Firewall
===============
If you have NAT, and your ISP always gives you the same IP address, you can
set the NAT to "manual" and enter this IP address. This is the most efficient
way to handke NATs.

If you have NAT but your ISP can give you a variable IP addresses, you can
select the option "Web Server" and enter a URL such as "checkip.dyndns.org".
This is a web site which returns your real address in response to a HTTP GET.
It will consult this web server for every call.

If you have several MYTH machines and want to make calls between them, then
you can disable NAT within your home by setting the netmask. Any calls 
to/from devices which fall into this netmask will not use the NAT address.

At your network router, you should configure it to forward port 5060 to your
Myth box that you want to receive calls.

If you have a firewall, open up port 5060 and whatever ports you choose for
audio and video media in the config screens.




CAVEATS
=======

* The video support is non-standard.  That is; it is H.263 but the way it 
is packetised is non-standard. So you will only get video mythfrontend-to-
mythfrontend. This will be fixed in a future release when I find something
standards-based to test against.

* There is no Microphone-volume control. This is because I use the microphone
within my USB webcam and Linux has no drivers for volume control on USB 
microphones. I will implement an attenuation algorithm if required.

* There is no echo cancellation. It really does need some. Anyone know where I
can find a public domain algorithm please let me know.

* To answer a call, you have to be in the Mythphone plugin. You do get a popup
whilst watching TV if someone calls; but in reality if you want to speak 
to someone you sort of need to call them first on a real phone!  Remember 
this is a first-cut of software so do't be too hard on me :-)

* It does not support registering with Service Providers which means you will
not be able to place/receive calls to normal phones. This is going to be my 
main priority once I am happy it works as far as it goes.




VXML PAGES
----------
Within the setup there is an option which allows entry of a VXML web-page. If
you only want voicemail; leave this blank, If you want to try some more complex
things like allowing setting of recording via the phone, then enter a URL in
this field pointing at an apache server. The files in the "vxml" folder contain
some scripts that do some things but they do need improvement and testing.

The following is a description of these files ...

index.vxml -- This is the main script; put in somewhere accessible by apache 
and configure with mythphone setup to point to this file. It basically prompts 
the caller to leave a voicemail or enter a pin. The pin is hard-coded in this 
file as "12345".

voicemail.vxml -- Place in the same directory as the above file. If during the 
execution of the above file the user asks to leave a voicemail it jumps to this 
file for recording a prompt.

securemenu.vxml -- Place in the same directory as the above two files. If during
the initial menu the user enters a correct pin it jumps to this file which then
prompt with a second-level menu such as "read the TV guide". Edit this file and
make sure it points to your "program_listing.php" file within mythweb.

config/*
themes/* -- These files add to the mythweb files to add a theme for VXML which
formats the TV Guide data ready for reading through the Text to Speech engine.
Copy these files into your mythweb directory structure.

init.php -- This is a copy of includes/init.php from mythweb with a couple of 
lines added to automatically select the vxml theme. If you have mythweb from 
0.14 you may may able to copy this straight over the top but either way the 
only difference should be the addition of the lines

	elseif (strpos($_SERVER['HTTP_USER_AGENT'],"MythPhone") !== false) // The browser is MythPhone
		define('Theme', 'vxml');




