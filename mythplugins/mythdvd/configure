#!/bin/sh
#
# Pathetic configure script for mythdvd
#

# default parameters
transcode="no"

for opt do
  case "$opt" in
  --enable-transcode) transcode="yes"
  ;;
  esac
done

if test x"$1" = x"-h" -o x"$1" = x"--help" ; then
cat << EOF

Usage: configure [options]
Options: [defaults in brackets after descriptions]

Standard options:
  --help                   print this message
  --enable-transcode       enable DVD ripping and transcoding [default=no]

EOF
exit 1
fi

echo "Creating config.h, config.pro, dvdmenu.xml, dvd_settings.xml"

echo ""
echo "Configuration settings: "
echo " "

echo "/*" >  ./mythdvd/config.h
echo "    Automatically generated by configure - do not modify" >> ./mythdvd/config.h
echo "*/" >> ./mythdvd/config.h

echo "#" > ./mythdvd/config.pro
echo "#    Automatically generated by configure - modify only under penalty of death" >> ./mythdvd/config.pro
echo "#" >> ./mythdvd/config.pro

echo "#" > ./mtd/config.pro
echo "#    Automatically generated by configure - modify only under penalty of death" >> ./mtd/config.pro
echo "#" >> ./mtd/config.pro

#
#   Copy over common start of xml menu files
#
cp ./mythdvd/dvdmenu.xml.pre ./mythdvd/dvdmenu.xml
cp ./mythdvd/dvd_settings.xml.pre ./mythdvd/dvd_settings.xml


if test "$transcode" = "yes" ; then
    echo "        Ripping/Transcoding support will be included"
    echo "#define TRANSCODE_SUPPORT 1" >> ./mythdvd/config.h

    #
    #   Conditional build and link stuff for mythdvd
    #
    echo "HEADERS += dvdripbox.h   dvdinfo.h   titledialog.h"   >> ./mythdvd/config.pro
    echo "SOURCES += dvdripbox.cpp dvdinfo.cpp titledialog.cpp" >> ./mythdvd/config.pro
    echo "LIBS    += -ldvdread"                                  >> ./mythdvd/config.pro

    #
    #   Conditional build and link stuff for mtd
    #
    echo "HEADERS += logging.h   mtd.h   serversocket.h   jobthread.h   dvdprobe.h   fileobs.h"   >> ./mtd/config.pro
    echo "SOURCES += logging.cpp mtd.cpp serversocket.cpp jobthread.cpp dvdprobe.cpp fileobs.cpp" >> ./mtd/config.pro
    echo "LIBS    += -ldvdread"                                          >> ./mtd/config.pro

    #
    #   Need to make the xml menus reflect this choice
    #
    cat ./mythdvd/dvdmenu.xml.mid >> ./mythdvd/dvdmenu.xml
    cat ./mythdvd/dvd_settings.xml.mid >> ./mythdvd/dvd_settings.xml

#  echo "LIBS += -lrfftw -lfftw" >> ./mythdvd/config.pro
#  echo "QMAKE_CXXFLAGS_RELEASE += `sdl-config --cflags`" >> ./mythdvd/config.pro
#  echo "QMAKE_CXXFLAGS_DEBUG += `sdl-config --cflags`" >> ./mythdvd/config.pro
fi

if test "$transcode" = "no" ; then
  echo "        Ripping/Transcoding support will not be included"
fi

#
#   Finish off the xml menu files
#
cat ./mythdvd/dvdmenu.xml.post >> ./mythdvd/dvdmenu.xml
cat ./mythdvd/dvd_settings.xml.post >> ./mythdvd/dvd_settings.xml


echo ""

