Installing mythtv on Mandrake 9.0
Robert Kulagowski, rkulagow@rocketmail.com
2002-11-07, v1.01

o  Introduction.

Installing on Mandrake 9.0 is made fairly simple since a lot of the
prerequisites are already packaged.  This README focuses mainly on getting
mythtv operational in North America.  Other sections will be added once I
get interested in mythweb, etc.

o  Checking prerequisites.

Make sure that you've got perl-5.8, mysql, gcc, freetype2-devel and qt-devel
installed on your system.  You can do this by clicking
K->Configuration->Packaging->KPackage

There are many inter-related modules, so make sure that you've got the main
package for each one, and not a sub package for an unrelated item.  For
example, there are many modules that have "perl" in them, some are a part of
the apache webserver, others are a part of the perl distribution.  In each
case, we're looking to make sure that the primary module is getting
installed.

Click the magnifying glass or press CTRL-F and enter "perl" as your search
term.  You should find it under the "Perl" folder.  You need at least the
perl 5.80 base package installed.  If not, click on the "Mark" button.

Next, search for mysql - it should be under "Databases".  Make sure that
mysql and mysql-clients are installed.  If not, click on "Mark".

Search for gcc.  You're going to need gcc and gcc-c++ installed.

Search for freetype2.  Make sure that you've got freetype2 and
freetype2-devel installed.

Finally, check for qt.  You'll need libqt3-devel (under folder "KDE and
Qt") and libqt3 ("Libraries").

If you marked anything to install, click on Install Marked.  Click "Yes" or
OK if you get a message about satisfying dependencies.

o  Setting up paths and ldconfig

There are some paths that need to be modified before starting the main
compile of mythtv.  It's best to get them out of the way first.

As root, create the following file in /etc/profile.d.  On my system I call
it "mythtv.sh".

Open a shell, and switch to superuser mode.
NOTE: ^D means press CTRL and d at the same time.

% su -
# cd /etc/profile.d
cat > mythtv.sh
export QTDIR=/usr/lib/qt3
export PATH=$PATH:/usr/lib/qt3/bin
^D

# chmod a+x mythtv.sh
# exit
% exit

The last two commands are to exit out of the shell.  This way, when you next
open a shell your new commands will take effect.

Open a shell and switch to superuser mode again.

% su -
# set

You should see QTDIR and the path changes you made.

Next, we need to make sure that the libraries that we're building will be
found when we need them.

Switch to /etc and execute the following:

# cd /etc
# cat >> ld.so.conf
/usr/local/lib
^D

# ldconfig
# exit
%

o  Downloading and compiling.

Get mythtv from the mythtv.org website.  Save the tarball to a directory you
can find.

Get XMLTV from http://xmltv.sourceforge.net.  Download version 0.5.2

Get lame from http://www.mp3dev.org/mp3.  Download the sourcecode to v3.92
by following the links to sourceforge.net

Build LAME first.

Open a shell and switch to the directory where you saved lame.

% tar -xzf lame-3.92.tar.gz
% cd lame-3.92
% ./configure
% make
% su -

Switch to the directory where you unpacked lame

# cd /home/[yourusername]/lame-3.92
# make install

Check that it worked:

# ls -l /usr/local/lib
-rw-r--r--    1 root     root       381706 Nov  4 14:22 libmp3lame.a
-rwxr-xr-x    1 root     root          674 Nov  4 14:22 libmp3lame.la*
lrwxrwxrwx    1 root     root           19 Nov  4 14:22 libmp3lame.so ->
libmp3lame.so.0.0.0*
lrwxrwxrwx    1 root     root           19 Nov  4 14:22 libmp3lame.so.0 ->
libmp3lame.so.0.0.0*
-rwxr-xr-x    1 root     root       360197 Nov  4 14:22 libmp3lame.so.0.0.0*

# exit
%

Untar the xmltv file:

% tar -xjf xmltv-0.5.2.tar.bz2
% cd xmltv-0.5.2

Install the xmltv prerequisites:

% su -
# perl -MCPAN -e shell

Check to see which version of TWIG is being offered by CPAN.  If it's 3.08,
we need to download it from the author's webiste, because 3.08 has a problem
with perl 5.8. As of 2002-11-02:

cpan> i /TWIG/
Author          STWIGGER ("Simon Twigger" <simont@mcw.edu>)
Distribution    M/MI/MIROD/XML-Twig-3.08.tar.gz
Module          XML::Twig       (M/MI/MIROD/XML-Twig-3.08.tar.gz)
3 items found

cpan>

This means that we need to do something a little different later on.  If
it's 3.09 or better, then execute:

cpan> install XML::Twig

and then the rest of the commands (no matter what the TWIG version was):

cpan> install Date::Manip
Date::Manip is up to date.
cpan> install LWP
cpan> install XML::Writer
cpan> exit

Download the 3.09 version of XMLTWIG from http://www.xmltwig.com/xmltwig/

% tar -xzf XML-Twig-3.09.tar.gz
% cd XML-Twig-3.09
% perl Makefile.PL
% make
% make test
% su -
# cd /home/[yourusername]/XML-Twig-3.09
# make install
# exit

Change to the XMLTV directory and compile it:
% cd xmltv-0.5.2
% perl Makefile.PL

You can answer "N" to the tv_check, tv_pick_cgi questions.  Say "yes" to
the grabber required for your location.

You may get errors about modules not being installed.  They shouldn't
matter if you're installing North America and have followed the instructions
to this point.

% make
% make test
% su -
% cd /home/[yourusername]/xmltv-0.5.2
# make install
# exit

Unpack mythtv

% tar -xjf mythtv-0.6.tar.bz2
% cd mythtv-0.6
% ./configure
% make

Change to superuser:
% su -
# cd /home/[yourusername]/mythtv-0.6
# make install
# exit

Make sure that mysql is running and started at boot.  Click on Mandrake
Control Center->System->Services

Setup the initial mysql databases:

% cd database
% mysql -u root < mc.sql

o  Setting up alsa and the mixer.

If your video doesn't appear to be in-sync with your audio, it could be
because you are listening to the real-time audio from your video card rather
than after it's been processed and synced to the video by mythtv.

What you need to do is to mute the "line-in" of your soundcard and also set
it as the recording source.

Open Kmix by K->Multimedia->Sound->Kmix

Click on Settings->Configure  Make sure that "Tick Marks" and "Show labels"
have "X"'s in them.  This will make it easier to find the correct audio
source.  Click OK.

On the mixer page, look for Line-In on your soundcard.  You should see two
LED's - a green one at the top, and a red one at the bottom.  The green one
at the top is for muting; you want to make sure that the green LED is a dark
green, meaning that it's "off".  You also want to click on the red LED so
that it turns bright red, indicating that it's "ON"; this insures that the
Line-in is used as the source.  Click OK, and make sure that you save the
settings so that this is your default.

o  Setting up a remote control.

You're going to need to download and compile lircd.  Go to
http://www.lircd.org and download lirc; as of 2002-11-07, the version
available is 0.6.6.  Grab the remotes.tgz file as well.

lircd has two prerequisites:  dialog, available in Mandrake through the
"cdialog" RPM, and the kernel source.  Mandrake 9.0 is using the 2.4.19
kernel, so the easiest thing is to go to http://www.kernel.org and download
the full 2.4.19 tar file.

Open a shell and login as superuser.

% su -
# cd /home/[yourusername]
# mkdir /usr/src
# mv linux-2.4.19.tar.bz2 /usr/src
# cd /usr/src
# tar -xjf linux-2.4.19.tar.bz2
# chown -R root.root linux-2.4.19
# ln -sf linux-2.4.19 linux
# exit
% tar -xjf lirc-0.6.6.tar.bz2
% cd lirc-0.6.6
% ./setup.sh

You're going to need to know what sort of receiver you have and where it's
connected.  In my case, I have a Pinnacle Studio TV card, with the IR
receiver connected to COM1 (/dev/ttys0), so once the configuration menu came
up I did Driver Configuration->Other Serial Port Devices->Pinnacle Systems
Receiver->OK and on the next page selected COM1->OK.

You then click "Save Configuration and run configure" to continue.

Once the configuration step is complete:

% make
% su -
# cd /home/[yourusername]
# make install
# chmod 666 /dev/lircd
# /usr/local/sbin/lircd
# cd /etc/rc.d
# cat >> rc.local
echo "Starting lircd"
/usr/local/sbin/lircd
^D
# exit
% 

This takes care of the lircd portion, which "listens" for the IR signals. 
The next step is to convert those signals into something that can be used to
mythtv.

% cd ~/mythtv-0.6/configfiles
% cp lircrc.example ~/.lircrc
% irxevent

Start pressing the keys on your remote; you should see them appear
on-screen.  If you don't see letters and digits at this point, you need to
troubleshoot further.

If it is working, then press CTRL-C to abort the program.  irxevent isn't a
daemon, so if it is working you need to run it like this:

% irxevent &

That's it.  Now, you can just follow the rest of the README and continue
from there.

