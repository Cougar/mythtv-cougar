<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">
<HTML>
<HEAD>
 <META NAME="GENERATOR" CONTENT="LinuxDoc-Tools 0.9.20">
 <TITLE>Installing and using mythtv: Configuring mythtv.</TITLE>
 <LINK HREF="mythtv-HOWTO-9.html" REL=next>
 <LINK HREF="mythtv-HOWTO-7.html" REL=previous>
 <LINK HREF="mythtv-HOWTO.html#toc8" REL=contents>
</HEAD>
<BODY>
<A HREF="mythtv-HOWTO-9.html">Next</A>
<A HREF="mythtv-HOWTO-7.html">Previous</A>
<A HREF="mythtv-HOWTO.html#toc8">Contents</A>
<HR>
<H2><A NAME="s8">8.</A> <A HREF="mythtv-HOWTO.html#toc8">Configuring mythtv.</A></H2>

<P>By this point, all of the prerequisites have been installed,
<B>mysql</B> is running and has had its initial database setup.  It's now
time to configure mythtv.</P>

<H2><A NAME="ss8.1">8.1</A> <A HREF="mythtv-HOWTO.html#toc8.1">Editing the settings.txt file.</A>
</H2>

<P>Open a shell and switch to the <CODE>/usr/local/share/mythtv</CODE> directory. 
You <B>MUST</B> edit the <CODE>settings.txt</CODE> file so that it's
appropriate for your system.  At a minimum, ensure that the BufferName, RecordFilePrefix
and PIPBuffername variables are set to directories that exist on your system. 
By default, these point to <CODE>/mnt/store</CODE>.  For example, you may wish to create
a <CODE>/var/video</CODE> subdirectory, so you would change <CODE>/mnt/store</CODE>
to <CODE>/var/video</CODE>
<BLOCKQUOTE><CODE>
<PRE>
% su
# mkdir /var/video
# chmod a+rwx /var/video
# exit
</PRE>
</CODE></BLOCKQUOTE>
 </P>
<P>The <CODE>settings.txt</CODE> file is fairly self-explanatory. 
Currently, mythtv supports two different video encoders, MPEG4 and RTJPEG. 
Take note that RTJPEG has lower CPU demands, but makes large files, and MPEG4
has high CPU demands, but makes smaller files.</P>
<P><B>NOTE</B>: although the width and height can be changed to almost
anything, if you start mythtv and don't see video or you get "segmentation
fault" errors, it is likely that the video4linux (v4l) subsystem did not
like the height and width parameters specified.  It's best to leave the
default as-is until you're sure that mythtv is operational.</P>
<P>
<A NAME="deinterlace_"></A> <B>NOTE</B>: the <CODE>int Deinterlace=1</CODE> variable controls the deinterlacer. 
Support for deinterlacing requires that your processor have MMX2.  Intel Celeron
and Pentium Pro CPUs do not have MMX2, so make sure that you've got this set
to "0" if you have one of these.  If you don't, you will get "Illegal
Instruction" errors.</P>
<P>Users in North America can now exit and save the file.  Users in other parts
of the world need to modify the first line and modify the XMLTVGrabber
variable to the correct grabber for their region.  <B>tv_grab_uk</B> for the
UK, etc.  Use the name from the xmltv directory.</P>

<H3>Adding support for an external tuner.</H3>

<P>mythtv supports changing the channel on an external tuner.  If you have
an external tuner, like a DirecTV or digital cable set top box, the
following command should be added to your settings.txt file:
<BLOCKQUOTE><CODE>
<PRE>
str ExternalChannelCommand=/usr/local/bin/changechannel
</PRE>
</CODE></BLOCKQUOTE>
</P>
<P>The <B>changechannel</B> program is not supplied with mythtv, so this is
going to be dependant on what sort of external tuner you have.</P>
<P>Feel free to browse some of what sort of hardware is available at 
<A HREF="http://shop.store.yahoo.com/snapstreammedia/cablepacks.html">http://shop.store.yahoo.com/snapstreammedia/cablepacks.html</A>, or if
you wish to assemble your own, rather than purchase, the following may be
helpful: 
<A HREF="http://www.snapstream.com/products/irblaster/sonydss.htm">http://www.snapstream.com/products/irblaster/sonydss.htm</A> for cable
pinouts for RCA DSS receivers.</P>

<H2><A NAME="ss8.2">8.2</A> <A HREF="mythtv-HOWTO.html#toc8.2">Running setup.</A>
</H2>

<P>Now that you've edited your <CODE>settings.txt</CODE> file, it's time to run the
setup program and perform the initial configuration.</P>
<P>Open a shell, and switch to the setup directory:</P>
<P>
<BLOCKQUOTE><CODE>
<PRE>
% cd setup
</PRE>
</CODE></BLOCKQUOTE>
</P>
<P><B>NOTE</B>:Red Hat Linux 8.0 uses an unusual character encoding scheme
that some programs don't deal well with. As a result, whenever you run setup
or mythfilldatabase you will have to set a variable to correct this problem.
Failure to set this variable will result in a lot of UTF-8 errors.</P>
<P>Red Hat 8.0 users, ensure that you do this:
<BLOCKQUOTE><CODE>
<PRE>
% env LANG=C setup 
</PRE>
</CODE></BLOCKQUOTE>
</P>
<P>instead of what all the other distributions should use:</P>
<P>
<BLOCKQUOTE><CODE>
<PRE>
% ./setup
</PRE>
</CODE></BLOCKQUOTE>
</P>
<P>The setup program will ask you a few questions and then proceed to run the
XMLTV grabber program.</P>

<H2><A NAME="ss8.3">8.3</A> <A HREF="mythtv-HOWTO.html#toc8.3">Running mythfilldatabase.</A>
</H2>

<P>Now that the setup program has completed, run <B>mythfilldatabase</B> to
get one week of data inserted into the database.</P>
<P>Red Hat 8.0 users, ensure that you do this:
<BLOCKQUOTE><CODE>
<PRE>
% env LANG=C mythfilldatabase
</PRE>
</CODE></BLOCKQUOTE>
</P>
<P>All other distributions can execute the following:</P>
<P>
<BLOCKQUOTE><CODE>
<PRE>
% mythfilldatabase
</PRE>
</CODE></BLOCKQUOTE>
</P>
<P><B>NOTE</B>:  <B>mythfilldatabase</B> might take a while to complete,
depending on any number of factors, most of which you can't control.  It's
best to just let the program run to completion.</P>
<P><B>mythfilldatabase --manual</B> is another option; the manual option will
allow you to fine tune channel frequencies and specify which channels will
be added to the database.</P>


<H3>Setting <B>mythfilldatabase</B> to run from <B>cron</B></H3>

<P>In order to keep your database filled, <B>mythfilldatabase</B> should be
run once a day.</P>
<P>There are two ways to accomplish this:  either as a user-based cron job, or
as a system based cron.  If you use a user-based cron, you can select the
time that the cron job will be run.  A system-based cron job will run at the
same time as any other system cron jobs.</P>
<P>If you are a Mandrake 9.0 user and wish to use a system cron job, you can
perform the following steps:
<BLOCKQUOTE><CODE>
<PRE>
% cd configfiles
% su
# cp mythfilldatabasecron /etc/cron.daily
</PRE>
</CODE></BLOCKQUOTE>
</P>
<P>If you want to know what time your job will run, you can do the following:
<BLOCKQUOTE><CODE>
<PRE>
# cat /etc/crontab
SHELL=/bin/bash
PATH=/sbin:/bin:/usr/sbin:/usr/bin
MAILTO=root
HOME=/

# run-parts
01 * * * * root nice -n 19 run-parts /etc/cron.hourly
02 4 * * * root nice -n 19 run-parts /etc/cron.daily
22 4 * * 0 root nice -n 19 run-parts /etc/cron.weekly
42 4 1 * * root nice -n 19 run-parts /etc/cron.monthly
# exit
%
</PRE>
</CODE></BLOCKQUOTE>
</P>
<P>We can see from the display that the cron.daily job will run at 0402 every
morning.</P>
<P>If you wish to specify a custom time, then the user-based cron job is the
better method.</P>
<P>The default <B>configfiles/mythcrontab</B> file will run the <B>mythfilldatabase</B>
program every day at 0430.  If you want to change this, then open the
<CODE>configfiles/mythcrontab</CODE> file in your favorite editor and modify it
as you like.  Once you're satisfied with the time that
<B>mythfilldatabase</B> will run, save and exit, and return to the shell
prompt.</P>
<P>
<BLOCKQUOTE><CODE>
<PRE>
% cd configfiles
% crontab mythcrontab
% crontab -l  NOTE: this is a lowercase L.
# The following will run the mythfilldatabase shell script at 0430
# every day.  Format is
# minutes hour day_of_month month day_of_week
# man 5 crontab for more information
# Need to use a shell script because the QTDIR environment variable isn't
# being honored by crontab?
# The next text should be all on the same line.
30 04 * * * /bin/bash $HOME/mythtv-0.7/MC/programs/mythfilldatabase/mythfilldatabasecron
% 
</PRE>
</CODE></BLOCKQUOTE>
</P>
<P>As you can see, <B>mythfilldatabase</B> will now be run at 0430
every day.</P>
<P>If you decide to alter the time that the <B>mythfilldatabase</B> runs,
you can use the crontab command to open your existing job and edit it in
place.</P>
<P>
<BLOCKQUOTE><CODE>
<PRE>
% crontab -e
</PRE>
</CODE></BLOCKQUOTE>
</P>
<P>The <B>crontab -e</B> command will allow you to edit the existing crontab. 
<B>NOTE</B>:  By default, the crontab will use <B>vi</B> as your
editor.  If you don't like to use <B>vi</B>, make sure that you've set
<CODE>VISUAL</CODE> to something other than <B>vi</B>.</P>
<P>
<BLOCKQUOTE><CODE>
<PRE>
% export VISUAL=/usr/bin/joe
% crontab -e
</PRE>
</CODE></BLOCKQUOTE>
</P>
<P>This will cause <B>crontab</B> to use <B>joe</B>, a visual editor that
uses the Wordstar command sequence.  You may use <B>emacs</B>, or any
other editor that you're comfortable with.  You may also add the
<CODE>EXPORT</CODE> command to your <CODE>.bashrc</CODE> or to the
<CODE>/etc/profile.d/mythtv.sh</CODE> file.</P>
<P>Once you've completed this step, run the <B>mythepg</B> program to check
that the database has been filled.  The cursor keys will move you around the
grid, the "I" key will give you more information on a program and ESC will
exit out back to the shell.</P>

<HR>
<A HREF="mythtv-HOWTO-9.html">Next</A>
<A HREF="mythtv-HOWTO-7.html">Previous</A>
<A HREF="mythtv-HOWTO.html#toc8">Contents</A>
</BODY>
</HTML>
