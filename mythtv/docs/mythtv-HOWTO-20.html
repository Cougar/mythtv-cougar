<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">
<HTML>
<HEAD>
 <META NAME="GENERATOR" CONTENT="LinuxDoc-Tools 0.9.21">
 <TITLE>Installing and using MythTV: Miscellaneous. </TITLE>
 <LINK HREF="mythtv-HOWTO-19.html" REL=previous>
 <LINK HREF="mythtv-HOWTO.html#toc20" REL=contents>
</HEAD>
<BODY>
Next
<A HREF="mythtv-HOWTO-19.html">Previous</A>
<A HREF="mythtv-HOWTO.html#toc20">Contents</A>
<HR>
<H2><A NAME="s20">20.</A> <A HREF="mythtv-HOWTO.html#toc20">Miscellaneous. </A></H2>

<H2><A NAME="ss20.1">20.1</A> <A HREF="mythtv-HOWTO.html#toc20.1">I'd like to watch the files without using MythTV / I'd like to convert the files to some other format. </A>
</H2>

<P>Matthew Zimmerman has created a patch for MPlayer / Mencoder 
<A HREF="http://www.mplayerhq.hu">http://www.mplayerhq.hu</A> that allows
you view the files created by MythTV.  MythTV doesn't use standard
Nupplevideo files, which is why you MPlayer complains if you try to view
them.</P>
<P><B>NOTE</B>:  If you're using a hardware MPEG2 encoder like the
PVR-250/350 you don't need to convert - the files are actually standard
MPEG2 with a <CODE>.nuv</CODE> extension.  Change it to <CODE>.mpg</CODE> and the
files should display properly in other media players.</P>
<P>Download the patch to MPlayer from Matt's website. 
<A HREF="http://dijkstra.csh.rit.edu:8088/~mdz/mythtv/">http://dijkstra.csh.rit.edu:8088/~mdz/mythtv/</A>.
<BLOCKQUOTE><CODE>
<PRE>
$ wget http://dijkstra.csh.rit.edu:8088/~mdz/mythtv/mplayer-0.90rc5-mythtv-20030407.diff
</PRE>
</CODE></BLOCKQUOTE>
</P>
<P>Download the source to MPlayer and patch:
<BLOCKQUOTE><CODE>
<PRE>
$ wget http://ftp.lug.udel.edu/MPlayer/releases/MPlayer-0.90.tar.bz2
$ tar -xjf MPlayer-0.90.tar.bz2
$ cp mplayer-0.90rc5-mythtv-20030407.diff MPlayer-0.90
$ cd MPlayer-0.90
$ patch -p1 &lt; mplayer-0.90rc5-mythtv-20030407.diff
</PRE>
</CODE></BLOCKQUOTE>
</P>
<P>At this point, you can read the MPlayer documentation and start the compile
process.</P>

<H2><A NAME="ss20.2">20.2</A> <A HREF="mythtv-HOWTO.html#toc20.2">I'd like to use some other window manager.</A>
</H2>

<P>MythTV is not dependent on any particular window manager.  If you wish to
run a lightweight window manager, the <CODE>configfiles/</CODE> directory has an
example of a <CODE>.twmrc</CODE> and <CODE>.fvwmrc</CODE> file you may use.</P>

<H2><A NAME="ss20.3">20.3</A> <A HREF="mythtv-HOWTO.html#toc20.3">I'd like MythTV to automatically startup.</A>
</H2>

<P>Here's an example submitted to the mythtv-dev list by Pat Pflaum
<A HREF="mailto:pat@netburp.com">mailto:pat@netburp.com</A> using fvwm:
<BLOCKQUOTE><CODE>
<PRE>
$ cat > .xinitrc
fvwm &amp;
mythfrontend
^D
$ cat > .fvwmrc
Style myth* NoTitle, NoHandles, Sticky, WindowListSkip, SloppyFocus, GrabFocus, BorderWidth 0
^D
$
</PRE>
</CODE></BLOCKQUOTE>
</P>
<P>The following also works with blackbox:
<BLOCKQUOTE><CODE>
<PRE>
$ cat > .xinitrc
xset -dpms s off &amp;
irxevent &amp;
mythfrontend &amp;
blackbox
</PRE>
</CODE></BLOCKQUOTE>
</P>
<P>Make sure that your <CODE>.blackboxrc</CODE> file has:
<BLOCKQUOTE><CODE>
<PRE>
session.screen0.focusNewWindows:        True
session.screen0.focusModel:     SloppyFocus
</PRE>
</CODE></BLOCKQUOTE>
 in it.</P>

<H2><A NAME="capture_resolution_"></A> <A NAME="ss20.4">20.4</A> <A HREF="mythtv-HOWTO.html#toc20.4">What capture resolution should I use?  How does video work?</A>
</H2>

<P>While MythTV allows you to set various GUI and capture resolutions, not
all combinations make sense.</P>
<P>First, analog video signals have a defined vertical resolution.  In NTSC,
the video standard specifies that there are 525 vertical scan lines.  Once
the "extra" lines are removed (they're used to synchronize the video signal,
and encode closed captioning data), you have 480 vertical lines.</P>
<P>In PAL, there are 625 "raw" lines of resolution, with a net of 576 vertical
lines.</P>
<P>Horizontally, the maximum you can expect from a Bt8X8 chip is 720.</P>
<P>With this in mind, there are certain commonly accepted values for
resolution.  While other values may be accepted, they will cause scan lines
to be repeated or dropped.</P>
<P>From "best" to "worst", in NTSC:
<UL>
<LI>720x480 (but more commonly, 704x480.  "DVD" resolution)</LI>
<LI>640x480 4:3</LI>
<LI>544x480 (TiVo high resolution)</LI>
<LI>480x480 (Video CD resolution)</LI>
<LI>352x480 (ReplayTV "Standard" quality)</LI>
<LI>320x480 </LI>
<LI>544x240</LI>
<LI>480x240 </LI>
<LI>352x240 </LI>
<LI>320x240</LI>
</UL>
</P>
<P>As you can see, the lower quality values are half of the better ones. 
720x240 is possible, but isn't a good tradeoff relative to the number of
vertical lines lost.  In a PAL country, the you would use values like
720x576 or x288.</P>
<P>The higher resolutions will be more CPU intensive. If the CPU is overtaxed,
frames will be dropped causing uneven motion. You will likely see the best
results at resolutions which average at least 10% CPU idle time.  You can
use system tools such as <CODE>top</CODE> or <CODE>sar</CODE> to check the CPU %
idle while recording.  If the CPU average usage is consistently exceeding
90%, frames will need to be dropped during peak times when more than 100% of
the available CPU would be needed to process all of the frames.</P>
<P>If you'd like to read more on this, go to the vcdhelp website at 
<A HREF="http://www.vcdhelp.com/forum/userguides/94382.php">http://www.vcdhelp.com/forum/userguides/94382.php</A>.</P>

<H2><A NAME="ss20.5">20.5</A> <A HREF="mythtv-HOWTO.html#toc20.5">MythTV GUI and X Display Sizes.</A>
</H2>

<P>MythTV is designed to be run as dedicated full screen TV application
but can also be run as a desktop application on a computer
monitor. Here are a few consideration for configuring sizes to best
suit you needs.</P>
<P>There are three sizes that are important for matching the MythTV GUI and
full screen TV playback to fit the screen:</P>
<P>
<UL>
<LI>the X display size</LI>
<LI>the X Desktop (virtual) dimensions</LI>
<LI>the MythTV GUI dimensions</LI>
</UL>
</P>
<P>The MythTV GUI uses its GUI dimensions regardless of the other two and is
anchored to the upper left corner of the X Desktop.</P>
<P>The MythTV full screen mode uses the X display size dimensions regardless of
the other two and is anchored to the upper left corner of the X display.</P>

<H3>X Dimensions</H3>

<P>For output to a Television, common resolutions are 640x480, 800x600, and
some rare devices support 1024x768. Generally, higher resolutions are
better. However, you may find that you prefer the picture quality at one of
the lower resolutions. Everything in MythTV is scalable and should 'fit'
regardless of the resolution you choose.</P>
<P>Edit your X configuration file, usually "XF86Config-4", so that the the
resolution you want to use is listed first in the lists under "Screen". If
this resolution is higher than the resolutions supported by your output
device, you will see a 'panning' effect where moving the mouse to the edge
will scroll around a desktop area which is larger than the display size. If
this happens, edit your X configuration file to match the display size then
restart X.</P>

<H3>MythTV Dimensions</H3>

<P>In 0.10 and later, from "mythfrontend" go to Setup->Appearance.
The default for the height and width is "0" - this will cause
MythTV to automatically size itself to full screen. To ensure that
your new dimension settings take effect, exit and restart MythTV.</P>
<P><B>NOTE</B>: When the GUI is full screen, you may need to set your window
manager to 'Click to Focus' for windows to stack properly.</P>
<P>The fonts for the GUI and OSD will scale to whatever sizes you use. Most
font sizes can be changed in setup selections. Make sure to use fonts large
enough to be read on a TV screen from a distance.</P>
<P>The full screen TV size is based on the X display size. For Xinerama, you
can specify a screen in Setup->General. The picture will be stretched to fit
the entire screen regardless of the 
<A HREF="#capture_resolution_">capture resolutions</A> used.</P>

<H3>Overscan Dimensions</H3>

<P>Because picture edges can be ragged and screen edges aren't straight,
Television is designed to project an image larger than the physical screen.
This is called "overscan". Underscan is fitting the entire image inside the
screen. This is useful for computer monitors so that toolbars and scrollbars
at the edges can be seen.</P>
<P>For best results, match the X display area as close as possible to the edges
of the physical screen. This can only be adjusted by your tv-out device or
by the settings for the television set. Many sets have these adjustments in
a 'service mode'.</P>
<P>MythTV has settings for "Overscan" in Setup->Playback. These can not, and do
not, cause the image to display beyond the edge of the X display area. The
purpose of these settings are to cut off rough edges and to expand the image
so that objects will appear to be the same size as a normal overscanned TV
picture.</P>

<H3>MythTV on the Desktop</H3>

<P>When using MythTV on a high resolution desktop monitor, set the MythTV
GUI dimensions to something much smaller than your X display resolution but
still large enough to read the fonts. The GUI screens will always be in the
upper left hand corner. However, your window manager may be able to minimize
these (ALT-F4 in KDE for example).</P>
<P>The TV picture will start in full screen mode. Press "f" to put the picture
in a window that can be moved and resized. By default, the picture uses the
recording resolution for its dimensions. If you check the box "Fixed
Aspect Ratio" in Setup->Playback, the windowed picture will always be
resized to normal 4:3 shape.</P>

<H2><A NAME="ss20.6">20.6</A> <A HREF="mythtv-HOWTO.html#toc20.6">I'd like to save or restore my database.</A>
</H2>

<P>See the <B>mysqldump</B> manpage for more information.
<BLOCKQUOTE><CODE>
<PRE>
$ mysqldump -u mythtv -pmythtv mythconverg > mythtv_backup.sql
</PRE>
</CODE></BLOCKQUOTE>
</P>
<P>To restore: (assuming that you've dropped the database)
<BLOCKQUOTE><CODE>
<PRE>
$ mysql -u root
mysql>create database mythconverg;
mysql>exit
$ mysql -u mythtv -pmythtv mythconverg &lt; mythtv_backup.sql
</PRE>
</CODE></BLOCKQUOTE>
</P>
<P>You may need to alter the mysql permissions if this database is being shared
with multiple systems.  See the 
<A HREF="mythtv-HOWTO-6.html#modify_perm_mysql">Modifying access to the MySQL database for multiple systems</A> section for more
information.</P>

<H2><A NAME="ss20.7">20.7</A> <A HREF="mythtv-HOWTO.html#toc20.7">I'd like to delete the mysql database.</A>
</H2>

<P><B>NOTE</B>:  Performing this step will remove the entire database. 
You will lose all of your settings and will need to re-run the mc.sql script
to setup the database structure before running the setup program.
<BLOCKQUOTE><CODE>
<PRE>
$ mysql -u root
mysql> drop database mythconverg;
mysql> quit
</PRE>
</CODE></BLOCKQUOTE>
</P>

<H2><A NAME="btaudio"></A> <A NAME="ss20.8">20.8</A> <A HREF="mythtv-HOWTO.html#toc20.8">btaudio </A>
</H2>

<P>btaudio allows you to obtain the audio data from your tuner card directly
over the PCI bus without using a soundcard.  This is useful if you would
like to use multiple tuner cards in a system without adding a soundcard for
each one, or if your existing soundcard is not capable of full-duplex
operation.</P>
<P>In order to use btaudio, your tuner card will need certain hardware
installed on it, and that hardware must be wired correctly.  The chip that
will allow you to use the btaudio module is the MSP34xx.  However, having a
MSP34xx is no guarantee that you will be able to use the btaudio module.</P>
<P>As of 2003-03-31, this is the current list of cards and their status:
Works with btaudio:</P>
<P>
<UL>
<LI>Hauppauge WinTV-radio with dbx-TV stereo, model 401</LI>
<LI>Hauppauge WinTV-Theater, model 495, 498 (Europe)</LI>
<LI>ATI TV Wonder</LI>
</UL>
</P>
<P>The following cards do not work:
<UL>
<LI>Pinnacle Studio PCTV Pro - note: this has a MSP34xx, but it's not
wired correctly to the BT878 chip.</LI>
<LI>ATI TV Wonder VE</LI>
<LI>Leadtek Winfast 2000 XP (PAL, UK and NTSC)</LI>
<LI>I/O Magic PC-PVR.  No MSP34xx chip.</LI>
</UL>
</P>
<P>The following cards have been reported to work, but have issues:
<UL>
<LI>Avermedia AVerTV Studio (no digital DSP output, "whiney noise" on
analog)</LI>
</UL>
</P>
<P>See <CODE>contrib/example.modules.conf.for.btaudio</CODE> for an example file on
how to configure btaudio on your system.</P>
<P>Once btaudio loads, it should register additional <CODE>/dev/dsp</CODE> and
<CODE>/dev/mixer</CODE> devices.  Typing <CODE>$ dmesg</CODE> will let you know
what's going on.</P>

<H2><A NAME="ss20.9">20.9</A> <A HREF="mythtv-HOWTO.html#toc20.9">Removing unwanted channels.</A>
</H2>

<P>If <B>mythfilldatabase</B> grabbed a channel which you do not want to
include in your TV listings, you can remove the entries from the xmltv
config file and the mysql database.  This often happens with premium
channels; for example, HBO or Showtime may be available on your cable TV
system, but is scrambled because you're not a subscriber to that channel. 
Since you can never watch it, you want to get rid of it.</P>
<P>First, comment out the channel from the &nbsp;/.mythtv/&lt;sourcename&gt;.xmltv file by
inserting a "#" in front of the unwanted entry. This will prevent
<B>mythfilldatabase</B> from grabbing future listings.</P>
<P>Next, delete the unwanted item from the channel table so that it will not
appear in the EPG or when changing channels.  The channels will always have
"1000" added to them, so for example, assuming that HBO is channel 15:
<BLOCKQUOTE><CODE>
<PRE>
$ mysql -u root mythconverg
mysql> delete from channel where chanid = '1015';
</PRE>
</CODE></BLOCKQUOTE>
</P>
<P>Old program data will be removed over the course of a week. However, you may
want to immediately delete any current program listings for the channel that
has been removed:
<BLOCKQUOTE><CODE>
<PRE>
$ mysql -u root mythconverg
mysql> delete from program where chanid = '1015';
</PRE>
</CODE></BLOCKQUOTE>
</P>
<P>
<A NAME="pvr250"></A> </P>
<H2><A NAME="ss20.10">20.10</A> <A HREF="mythtv-HOWTO.html#toc20.10">I'd like to use a hardware MPEG-2 encoder (ie, a PVR-250/350).</A>
</H2>

<P><B>NOTE</B>:  THE FOLLOWING DOCUMENTATION IS PROVIDED AS-IS AND IS
NOT GUARANTEED TO WORK WITH YOUR DISTRIBUTION.  FOR IVTV DRIVER ASSISTANCE,
SEE THE IVTV MAILING LIST.  
<A HREF="https://lists.sourceforge.net/lists/listinfo/ivtv-devel">https://lists.sourceforge.net/lists/listinfo/ivtv-devel</A>  SEE THE
IVTV FAQ IF YOU HAVE QUESTIONS OR ISSUES.  
<A HREF="http://ivtv.sourceforge.net/FAQ.html">http://ivtv.sourceforge.net/FAQ.html</A></P>
<P>These instructions work for Mandrake 9.1 on a backend machine which is
hosting a single PVR-250 capture card.</P>
<P>Install the Mandrake kernel source.  If you are using a different Mandrake
kernel level (ie, not 2.4.21-0.16mdk as in the example below, then alter the
<B>urpmi</B> command appropriately.)
<BLOCKQUOTE><CODE>
<PRE>
$ uname -a
Linux pvr 2.4.21-0.16mdk #1 Fri Apr 11 06:51:54 CEST 2003 i686 unknown
unknown GNU/Linux

$ su
# urpmi kernel-source
</PRE>
</CODE></BLOCKQUOTE>
</P>
<P><B>NOTE</B>:  You do not need to recompile your kernel.</P>
<P>Download the IVTV driver from CVS:
<BLOCKQUOTE><CODE>
<PRE>
$ cvs -d:pserver:anonymous@cvs.sourceforge.net:/cvsroot/ivtv login
&lt;enter> as password
$ cvs -z3 -d:pserver:anonymous@cvs.sourceforge.net:/cvsroot/ivtv co ivtv
</PRE>
</CODE></BLOCKQUOTE>
</P>
<P>This should create an ivtv directory.  Switch to it and perform the
following commands:
<BLOCKQUOTE><CODE>
<PRE>
$ cd ivtv/ivtv/utils
$ wget http://hauppauge.lightpath.net/software/pvr250/pvr250_16_21062.exe
$ su
# ./ivtvfwextract.pl pvr250_16_21062.exe
# exit
</PRE>
</CODE></BLOCKQUOTE>
</P>
<P>The <B>ivtvfwextract</B> program extracts the firmware required for the
card.  You may want to go to the Hauppauge website and download the latest
Windows driver if the <B>wget</B> command fails.</P>
<P>Next, compile the driver:
<BLOCKQUOTE><CODE>
<PRE>
$ cd ~/ivtv/ivtv/driver
$ make
</PRE>
</CODE></BLOCKQUOTE>
</P>
<P><B>NOTE</B>: You may get warnings about i2c during the compile.  Ignore
them.</P>
<P>Add the following to <CODE>/etc/modules.conf</CODE>:
<BLOCKQUOTE><CODE>
<PRE>
alias char-major-81     videodev
alias char-major-81-0   ivtv
options ivtv debug=1
options tuner type=2
options msp3400 once=1 simple=1
add below ivtv msp3400 saa7115 tuner
</PRE>
</CODE></BLOCKQUOTE>
</P>
<P><B>NOTE</B>:  You must specify the tuner type manually.  See
<CODE>~/ivtv/ivtv/driver/tuner.h</CODE> for a listing of tuners.  In the above
example, <CODE>tuner type=2</CODE> is a Phillips NTSC.  Use an appropriate tuner
type for your system and video standard.  The <CODE>debug=1</CODE> parameter on
the ivtv line actually means less debugging output will be printed.</P>
<P>Next, copy the files that were compiled in the driver directory into the
appropriate modules directory:
<BLOCKQUOTE><CODE>
<PRE>
$ su
# make install
# depmod -a
</PRE>
</CODE></BLOCKQUOTE>
</P>
<P>Finally, load the ivtv driver:
<BLOCKQUOTE><CODE>
<PRE>
# modprobe ivtv
# exit
</PRE>
</CODE></BLOCKQUOTE>
</P>
<P>Check that the card is being recognized on the PCI bus:
<BLOCKQUOTE><CODE>
<PRE>
$ lspci -v
&lt;snip>

00:0c.0 Multimedia video controller: Internext Compression Inc iTVC15 MPEG-2
Encoder (rev 01)
        Subsystem: Hauppauge computer works Inc.: Unknown device 4801
        Flags: bus master, medium devsel, latency 32, IRQ 11
        Memory at d0000000 (32-bit, prefetchable) [size=64M]
        Capabilities: &lt;available only to root>
</PRE>
</CODE></BLOCKQUOTE>
</P>
<P>If you don't see your card on the PCI bus, make sure that it's been
installed in a bus-master slot.  For some motherboards, only the PCI slots
closest to the AGP slot are bus-mastering.</P>
<P>Check that the ivtv driver has created a new video device:
<BLOCKQUOTE><CODE>
<PRE>
$ ls -l /dev/v4l/vi*
crw-------    1 mythtv   sys       81, 224 Dec 31  1969 vbi0
crw-------    1 mythtv   sys       81,   0 Dec 31  1969 video0
crw-------    1 mythtv   sys       81,  32 Dec 31  1969 video32
</PRE>
</CODE></BLOCKQUOTE>
</P>
<P>In this case, the ivtv device is <CODE>video0</CODE>.</P>
<P>Go into <CODE>setup/setup</CODE> on the machine hosting the hardware MPEG-2 card.
When you add a new capture card, ensure that you are using the
<CODE>video0</CODE> device.  </P>
<P><B>NOTE</B>:  As of 2003-04-25 the ivtv driver does not support VBI, so
closed-captioning is not available.</P>
<P>Leave the VBI device, audio device and audio sampling rate limit at the
default values.  Change the default input to an appropriate setting for your
configuration.  Change the card type to "Hardware MPEG Encoder Card" and
press ENTER.</P>
<P>The remaining setup is just like a standard V4L card; define a video source
if you have not already done so, and assign the video source to a video card
input on the Input Connections screen.</P>
<P>Some people report issues with the ivtv module not being loaded when
required by MythTV.  To get around this, you can <B>modprobe</B> the ivtv driver
before using it.  The simplest technique is to add the <B>modprobe</B>
command to <CODE>/etc/rc.d/rc.local</CODE>:
<BLOCKQUOTE><CODE>
<PRE>
# echo "/sbin/modprobe ivtv" >> /etc/rc.d/rc.local
</PRE>
</CODE></BLOCKQUOTE>
</P>
<P>By default, the IVTV driver uses a 16Mbps peak rate with a 8Mbps VBR.  This
will create files at about 4GB/hour.  If you wish to adjust these
parameters, add something like the following to your <CODE>rc.local</CODE>:
<BLOCKQUOTE><CODE>
<PRE>
/path/to/ivtv/utils/test_ioctl -c bitrate=4500000,bitrate_peak=6000000
</PRE>
</CODE></BLOCKQUOTE>
</P>
<P>The actual values to use should be adjusted to your liking and in part
depend on the capture resolution.  The above example is more than adequate
for 480x480.  Once the IVTV API has settled down MythTV will incorporate the
ability to modify the bitrate internally.</P>
<P>
<A NAME="troubleshooting_pvraudio"></A> <B>NOTE</B>:  some people complain
that their PVR-250/350 card is not capturing audio.  The most likely source
for this is that your system is not loading the correct msp3400.o file; ivtv
uses a custom msp3400.c, and if the resulting module isn't loaded you will
not get sound.  Switch to your <CODE>/lib/modules</CODE> directory and rename
the existing msp3400.o file, then copy the <CODE>msp3400.o</CODE> from the ivtv
driver directory and re-run <B>depmod</B>.  If that still doesn't work,
then check the ivtv mailing list for more information.</P>
<P><B>NOTE</B>:  Some people report "ghosting" issues with their PVR-250s,
where there is a faint copy of whatever is on the screen appearing to the
right of the image.  If you have this issue, it's fairly obvious.  This is a
firmware issue, apparently.  There are two ways around this:
<OL>
<LI>Run at 720x480 resolution</LI>
<LI>Turn off DNR</LI>
</OL>
</P>
<P>To turn off DNR, add the following to your <CODE>rc.local</CODE>:
<BLOCKQUOTE><CODE>
<PRE>
/path/to/ivtv/utils/test_ioctl --set-codec-params=dnr_mode=0,dnr_temporal=0
</PRE>
</CODE></BLOCKQUOTE>
</P>

<H2><A NAME="ss20.11">20.11</A> <A HREF="mythtv-HOWTO.html#toc20.11">I'd like to use NFS.</A>
</H2>

<P>You may want to use a central server to store your files.  </P>
<P>On the host machine, (in this case, the hostname is "masterbackend") you'll
want to edit your <CODE>/etc/exports</CODE> file and use something like:
<BLOCKQUOTE><CODE>
<PRE>
/var/video (rw)
</PRE>
</CODE></BLOCKQUOTE>
</P>
<P>To export the <CODE>/var/video</CODE> directory with read / write privileges.</P>
<P>On the "slave" machine, you'll want to edit the <CODE>/etc/fstab</CODE> file and
add something like:
<BLOCKQUOTE><CODE>
<PRE>
masterbackend:/var/video /var/video nfs rsize=8192,wsize=8192,soft,nfsvers=3
</PRE>
</CODE></BLOCKQUOTE>
</P>
<P>Then run <CODE># fstab -a</CODE> to re-read the file to mount the file system.</P>
<P>In this case, the source is a machine called "masterbackend" which is
exporting the directory "/var/video", which we're mounting locally at
"/var/video".  The rsize and wsize options are used to increase the
performance of NFS; soft mean that NFS will eventually timeout on an error,
and the nfsvers is required for filesizes over 2GB.</P>
<P>
<A NAME="mythbackend_autostart"></A> </P>
<H2><A NAME="ss20.12">20.12</A> <A HREF="mythtv-HOWTO.html#toc20.12">I'd like to automatically start mythbackend at system boot time.</A>
</H2>

<H3>Red Hat And Mandrake</H3>

<P>Here's a method for automatically starting mythbackend submitted by Mike
Thomson (
<A HREF="mailto:linux@m-thomson.net">mailto:linux@m-thomson.net</A>) and Stu Tomlinson (
<A HREF="mailto:stu@nosnilmot.com">mailto:stu@nosnilmot.com</A>).</P>
<P>Copy the files from the MythTV <CODE>contrib</CODE> directory or from Mike's web
site (
<A HREF="http://m-thomson.net/mythtv/">http://m-thomson.net/mythtv/</A>) as follows:</P>
<P><CODE>etc.rc.d.init.mythbackend</CODE> should be made executable and copied to
<CODE>/etc/rc.d/init.d/</CODE>:
<BLOCKQUOTE><CODE>
<PRE>
$ cd contrib
$ su
# chmod a+x etc.rc.d.init.d.mythbackend
# cp etc.rc.d.init.d.mythbackend /etc/rc.d/init.d/mythbackend
</PRE>
</CODE></BLOCKQUOTE>
</P>
<P><CODE>etc.sysconfig.mythbackend</CODE> should be copied to
<CODE>/etc/sysconfig/</CODE>:
<BLOCKQUOTE><CODE>
<PRE>
$ cd contrib
$ su
# cp etc.sysconfig.mythbackend /etc/sysconfig/mythbackend
</PRE>
</CODE></BLOCKQUOTE>
</P>
<P>Edit <CODE>/etc/sysconfig/mythbackend</CODE> if you want to change the defaults
(the userid that should start mythbackend, location of the logfile and (if
required) the name and location of the mythbackend binary).</P>
<P>Use <B>chkconfig</B> to make sure the script is called when
entering runlevels 3, 4 or 5:
<BLOCKQUOTE><CODE>
<PRE>
$ su
# chkconfig --level 345 mythbackend on
# exit
$
</PRE>
</CODE></BLOCKQUOTE>
</P>

<H3>Log files </H3>

<P>By default, the log file for mythbackend will be written to
<CODE>/var/tmp/mythbackend.log</CODE>. This has been tested and is known to work
on Mandrake and Red Hat, but many people prefer to place logs under
<CODE>/var/log/</CODE>.</P>
<P>To do this, create a group called <CODE>mythtv</CODE> (or anything you prefer)
and add your usual MythTV users to that group. If you changed the user that
starts mythbackend from the default of root you <EM>must</EM> perform this
step.</P>
<P>Create the directory <CODE>/var/log/mythtv</CODE> and set its
permissions as follows:
<BLOCKQUOTE><CODE>
<PRE>
$ su
# mkdir /var/log/mythtv
# chown root:mythtv /var/log/mythtv
# chmod 0775 /var/log/mythtv
# exit
$ ls -ld /var/log/mythtv
drwxrwxr-x    2 root     mythtv       4096 Apr 28 21:58 /var/log/mythtv/
$
</PRE>
</CODE></BLOCKQUOTE>
</P>

<H3>Mandrake 9.x</H3>

<P>Mandrake adds one more twist in the form of the <CODE>msec</CODE> utility,
which runs regularly and (at the default or any higher security level) sets
permissions on many files, including those under <CODE>/var/log</CODE>.</P>
<P>To tell msec about the MythTV log files and their directory, you need to
edit the <CODE>/etc/security/msec/perm.local</CODE> file to include the
following:
<BLOCKQUOTE><CODE>
<PRE>
# /etc/security/msec/perm.local
# Local overrides to the msec program
#
# Full file path                user.group              permissions
/var/log/mythtv/                root.mythtv             775
/var/log/mythtv/*               root.mythtv             664
</PRE>
</CODE></BLOCKQUOTE>
</P>
<P>A copy of the above has been included in the contrib/ directory.  You may
add it by typing:
<BLOCKQUOTE><CODE>
<PRE>
$ cd contrib
$ su
# cat etc.security.msec.perm.local >> /etc/security/msec/perm.local
# exit
</PRE>
</CODE></BLOCKQUOTE>
</P>
<P>Finally run the <CODE>msec</CODE> tool to check and implement your
changes.
<BLOCKQUOTE><CODE>
<PRE>
$ su
# msec
# exit
$
</PRE>
</CODE></BLOCKQUOTE>
</P>
<P><B>NOTE</B>: msec can only <EM>reduce</EM> the permissions of files, so if
you don't get the results you expect, check that you're not asking
<CODE>msec</CODE> to add missing permissions to the files or directories you
created.</P>
<H3>Gentoo</H3>

<P>The portage file for MythTV has scripts that will allow you to run
mythbackend at startup.</P>
<P>To run mythbackend as a daemon which starts at boot time:
<BLOCKQUOTE><CODE>
<PRE>
# rc-update add mythbackend default
</PRE>
</CODE></BLOCKQUOTE>
</P>
<P>To stop mythbackend as a daemon:
<BLOCKQUOTE><CODE>
<PRE>
# /etc/init.d/mythbackend stop
</PRE>
</CODE></BLOCKQUOTE>
</P>
<P>To obtain a list of options:
<BLOCKQUOTE><CODE>
<PRE>
# /etc/init.d/mythbackend
</PRE>
</CODE></BLOCKQUOTE>
</P>

<H2><A NAME="advanced_backend_config"></A> <A NAME="ss20.13">20.13</A> <A HREF="mythtv-HOWTO.html#toc20.13">Advanced Backend Configurations. </A>
</H2>

<P>MythTV is flexible in the way that you define multiple backend tuner
configurations.  The only hard-and-fast rule is that the Master Backend
<EM>must</EM> have a capture device defined, but shouldn't imply that the
capture device in the MBE must be the first capture card defined in the
database.</P>
<P>One example of an advanced configuration is the round-robin scheme.  Rather
than defining all of the cards on the master, you could first go into setup
on the master to define globals such as the general configuration and the
channel lineup but not the host-specific configuration item like the capture
card.  In this example, we will use a 4 tuner configuration, where two
slaves have one card each and the master has two.
<OL>
<LI>Add the first capture card on one of the slaves.  Complete the
configuration, connecting the input source to the card.  This will get
cardid #1 in the database.  Exit setup.</LI>
<LI>Configure the first capture card on the master backend.  This will get
cardid #2 in the database.  Exit setup.</LI>
<LI>Configure the first capture card on the second slave.  This will be
cardid #3 in the database.  Exit setup.</LI>
<LI>Configure the second capture card on the master backend.  This will
get cardid #4 in the database.  Exit setup.</LI>
</OL>
</P>
<P>Using this scheme, the master backend will not use both capture cards until
one of the following happens:
<UL>
<LI>There are four recordings scheduled for the same time</LI>
<LI>Both slaves are not available</LI>
</UL>
</P>
<P>The scheduler in MythTV checks whether an encoder is available; if a slave
backend isn't running, its encoder isn't available, so the scheduler will
look for the next available encoder.  This makes MythTV very flexible; slave
tuners can come and go, and as long as there are enough tuners for what
you'd like to record it doesn't matter which tuner in particular is going to
be used.</P>
<P>Using this round-robin scheme along with a shared storage directory like
NFS and enabling the Master Backend Override setting will allow you to view
content even if the slave backend that recorded a program is not available.</P>

<H2><A NAME="advancedpartitionformatting"></A> <A NAME="ss20.14">20.14</A> <A HREF="mythtv-HOWTO.html#toc20.14">Advanced Partition Formatting. </A>
</H2>

<P>MythTV creates large files.  The partitions that your distribution sets
up for you may not be optimized for large files.</P>
<H3>Ext3</H3>

<P>With Ext3, your biggest gain is that in case of a crash and reboot you
don't have to wait very long for your partition to be remounted.  With Ext2,
the <B>fsck</B> may take a long time to run on multi-gigabyte partitions.</P>
<P>When formatting the partition, the following command line should be better
than the default.  This example assumes that <CODE>/dev/hdb1</CODE> has already
been created using <B>fdisk</B>.
<BLOCKQUOTE><CODE>
<PRE>
# mkfs.ext3 -T largefile4 -m 0 /dev/hdb1
</PRE>
</CODE></BLOCKQUOTE>
</P>
<P>The "-T largefile4" option creates one inode per 4 megabytes.  The "-m 0"
(zero, not "oh") parameter sets the amount of spaced reserved for root to
zero. By default, this is 5%, which on a multi-gigabyte drive is a lot of
reserved space.</P>
<P>You may also modify some aspects of a filesystem such as the reserved block
percentage after it has been created using the <B>tune2fs</B> program:
<BLOCKQUOTE><CODE>
<PRE>
# tune2fs -m 0 /dev/hdb1
</PRE>
</CODE></BLOCKQUOTE>
</P>
<P>You can check on your filesystem using the <B>dumpe2fs</B> program.  See
the <B>man</B> page for details.</P>

<H2><A NAME="ss20.15">20.15</A> <A HREF="mythtv-HOWTO.html#toc20.15">I'd like to have more flexible disk storage with LVM. </A>
</H2>

<P>LVM greatly increases the flexibility you have in managing your storage
than traditional physical partitions. This section will provide some brief
notes on how to use LVM to create storage space for your video files and how
to add additional disk space in the future. There's lots more that can be
done with LVM, so check the LVM HOWTO 
<A HREF="http://tldp.org/HOWTO/lvm-HOWTO/">http://tldp.org/HOWTO/lvm-HOWTO/</A> document for details.</P>
<P>Make sure your kernel configuration includes LVM support or that it's
available as a module. Today, most vendors include this by default. You'll
also want to ensure that you have a copy of the LVM utilities; check your
distribution, or get the latest versions from 
<A HREF="http://www.sistina.com/products_lvm.htm">http://www.sistina.com/products_lvm.htm</A> and build them manually.</P>
<P>Check that the <B>vgscan</B> program is being run at some point during
your boot sequence - most distributions do this by default. Look for a
message during boot up that looks like this:
<CODE>vgscan -- reading all physical volumes (this may take a while...)</CODE></P>
<P>LVM uses a few concepts you should be familiar with before starting.
<UL>
<LI>PV (Physical Volume).  The actual partition on the hard drive.</LI>
<LI>VG (Volume Group).  The aggregation of all the PVs make a VG.</LI>
<LI>LV (Logical Volume).  Subdivision of the pool of space available in
the VG into individual chunks, like /usr, /var/video, etc.</LI>
</UL>
</P>
<P>The following example assumes that you want to create a LVM partition from a
chunk of space in /dev/hda5, using a reiserfs filesystem and mounted on
/var/video. You later decide to extend this filesystem by adding a new disk:
/dev/hdb.</P>
<P>You need to create at least one LVM partition for a physical volume. Use
<B>fdisk</B> or your favorite partition editor to set the type to LVM
(0x8e). If you're using an entire disk, create one big partition rather than
using the device itself. e.g. use /dev/hdb1 not /dev/hdb.</P>
<P><CODE># fdisk /dev/hda</CODE>
.... create partition 5, save partition table and reboot if you have to</P>
<P>Create the LVM physical volume from the partitions (repeat if you have
multiple partitions to use):
<BLOCKQUOTE><CODE>
<PRE>
# pvcreate /dev/hda5
</PRE>
</CODE></BLOCKQUOTE>

Create a LVM volume group out of this physical volume called "VGforMyth" that is
allocated in chunks that are a multiple of 64MB
<BLOCKQUOTE><CODE>
<PRE>
# vgcreate --name VGforMyth -s 64m /dev/hda5
</PRE>
</CODE></BLOCKQUOTE>

Create a logical volume of 20GB called "video" and then create the reiserfs
filesystem and mount it:
<BLOCKQUOTE><CODE>
<PRE>
# lvcreate --name video --size 20G VGforMyth
# mkreiserfs /dev/VGforMyth/video
# mount /dev/VGforMyth/video /var/video
</PRE>
</CODE></BLOCKQUOTE>

Now create a 5GB volume for mythmusic files if you like:
<BLOCKQUOTE><CODE>
<PRE>
# lvcreate --name music --size 5G VGforMyth
# mkreiserfs /dev/VGforMyth/music
# mount /dev/VGforMyth/music /var/music
</PRE>
</CODE></BLOCKQUOTE>

Display the volume group status:
<CODE># vgdisplay -v</CODE></P>
<P>Now, lets suppose you want to add a 60GB hard disk to the system as hdb and
allocate 50GB of it to video storage.</P>
<P>First, create a single partition /dev/hdb1 covering the whole disk and make
it type 0x8e using your partition editor.</P>
<P><CODE># fdisk /dev/hdb</CODE>
.... create partition, set type, save and reboot if it says you have to</P>
<P>Create the new LVM physical volume:</P>
<P><CODE># pvcreate /dev/hdb1</CODE></P>
<P>Add the new physical volume to the volume group:</P>
<P><CODE># vgextend VGforMyth /dev/hdb1</CODE></P>
<P><B>NOTE</B>:  You may get errors at this point stating that there are no
physical volumes available for adding to the LV, even though you know for a
fact that there are.  You may need to specify the physical volume in the 
<CODE>/dev/ide/host/bus/target/lun/etc</CODE> format.</P>
<P>Once you've completed one of the following two procedures, use <B>df</B>
to check that you've got more space.</P>

<H3>ReiserFS</H3>

<P>Make the logical volume used for video bigger:</P>
<P><CODE># lvextend --size +50G /dev/VGforMyth/video</CODE></P>
<P>Unmount, resize and remount the filesystem.  Technically, you don't need to
unmount and remount the ReiserFS. 
<BLOCKQUOTE><CODE>
<PRE>
# umount /var/video
# resize_reiserfs /dev/VGforMyth/video
# mount /dev/VGforMyth/video /var/video
</PRE>
</CODE></BLOCKQUOTE>
</P>

<H3>ext2 or ext3</H3>

<P>LVM comes with a program called <B>e2fsadm</B>.</P>
<P>Unmount, resize and remount the filesystem.  The filesystem <EM>must</EM> be
unmounted during this procedure.
<BLOCKQUOTE><CODE>
<PRE>
# umount /var/video
# e2fsadm --size +50G /dev/VGforMyth/video
# mount /dev/VGforMyth/video /var/video
</PRE>
</CODE></BLOCKQUOTE>
</P>

<HR>
Next
<A HREF="mythtv-HOWTO-19.html">Previous</A>
<A HREF="mythtv-HOWTO.html#toc20">Contents</A>
</BODY>
</HTML>
